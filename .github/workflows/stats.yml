name: Generate GitHub Stats

on:
  schedule:
    - cron: "0 */12 * * *"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Fetch GitHub stats
        run: |
          curl -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
               https://api.github.com/users/PriyanshuSingh44 \
               > user.json

          public_repos=$(jq '.public_repos' user.json)
          followers=$(jq '.followers' user.json)

          echo "<svg xmlns='http://www.w3.org/2000/svg' width='400' height='120'>
          <style>
          text { font: 14px sans-serif; fill: white; }
          </style>
          <rect width='100%' height='100%' rx='10' ry='10' fill='#141321'/>
          <text x='20' y='40'>Public Repos: $public_repos</text>
          <text x='20' y='70'>Followers: $followers</text>
          <text x='20' y='100'>Username: PriyanshuSingh44</text>
          </svg>" > stats.svg

      - name: Commit stats
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add stats.svg
          git commit -m "Update custom GitHub stats" || exit 0
          git push
